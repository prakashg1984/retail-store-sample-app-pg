#Install Docker in Amazon Linux
sudo dnf update -y
sudo dnf install -y docker
sudo systemctl enable --now docker
sudo usermod -aG docker $USER
newgrp docker

sudo systemctl start docker

#Install Docker Compose in Amazon Linux
sudo mkdir -p /usr/local/lib/docker/cli-plugins
sudo curl -SL https://github.com/docker/compose/releases/latest/download/docker-compose-linux-$(uname -m) -o /usr/local/lib/docker/cli-plugins/docker-compose
sudo chmod +x /usr/local/lib/docker/cli-plugins/docker-compose

#Verify
docker compose version


#Create a public ECR Repository

#Local MVN Build and Docker Build, Tag, Push
mvn clean install
aws ecr-public get-login-password --region us-east-1 | docker login --username AWS --password-stdin public.ecr.aws
docker build -t retail-store-sample-orders .
docker tag retail-store-sample-orders:latest <public repo url>
docker push <public repo url>


#Download, Edit and Run the docker compose

wget https://github.com/aws-containers/retail-store-sample-app/releases/latest/download/docker-compose.yaml

#Edit docker compose yaml to expose orders app in ingress
    ports:
      - mode: ingress
        protocol: tcp
        published: "8082"
        target: 8080
        
#Edit the docker image name in docker compose yaml
image: public.ecr.aws/aws-containers/retail-store-sample-orders:1.3.0


DB_PASSWORD='<some password>' docker compose --file docker-compose.yaml up -d

docker compose -f docker-compose.yaml down


UI - http://localhost:8888

Orders - http://localhost:8082
